// PLUGINS                  ----------------------------------------
// Normalized address bar hiding for iOS & Android (c) @scottjehl MIT License
(function(e){var t=e.document;if(!location.hash&&e.addEventListener){e.scrollTo(0,1);var n=1,r=function(){return e.pageYOffset||t.compatMode==="CSS1Compat"&&t.documentElement.scrollTop||t.body.scrollTop||0},i=setInterval(function(){if(t.body){clearInterval(i);n=r();e.scrollTo(0,n===1?0:1)}},15);e.addEventListener("load",function(){setTimeout(function(){r()<20&&e.scrollTo(0,n===1?0:1)},0)},!1)}})(this);$(function(){var e=$("iframe[src^='http://player.vimeo.com'], iframe[src^='http://www.youtube.com'], object, embed"),t=$("figure");e.each(function(){$(this).attr("data-aspectRatio",this.height/this.width).removeAttr("height").removeAttr("width")});$(window).resize(function(){var n=t.width();e.each(function(){var e=$(this);e.width(n).height(n*e.attr("data-aspectRatio"))})}).resize()});(function(e){e.isScrollToFixed=function(t){return e(t).data("ScrollToFixed")!==undefined};e.ScrollToFixed=function(t,n){function m(){s.trigger("preUnfixed.ScrollToFixed");x();s.trigger("unfixed.ScrollToFixed");h=-1;f=s.offset().top;l=s.offset().left;r.options.offsets&&(l+=s.offset().left-s.position().left);c==-1&&(c=l);o=s.css("position");i=!0;if(r.options.bottom!=-1){s.trigger("preFixed.ScrollToFixed");E();s.trigger("fixed.ScrollToFixed")}}function g(){var e=r.options.limit;return e?typeof e=="function"?e.apply(s):e:0}function y(){return o==="fixed"}function b(){return o==="absolute"}function w(){return!y()&&!b()}function E(){if(!y()){p.css({display:s.css("display"),width:s.outerWidth(!0),height:s.outerHeight(!0),"float":s.css("float")});cssOptions={position:"fixed",top:r.options.bottom==-1?N():"",bottom:r.options.bottom==-1?"":r.options.bottom,"margin-left":"0px"};r.options.dontSetWidth||(cssOptions.width=s.width());s.css(cssOptions);s.addClass("scroll-to-fixed-fixed");r.options.className&&s.addClass(r.options.className);o="fixed"}}function S(){var e=g(),t=l;if(r.options.removeOffsets){t=0;e-=f}cssOptions={position:"absolute",top:e,left:t,"margin-left":"0px",bottom:""};r.options.dontSetWidth||(cssOptions.width=s.width());s.css(cssOptions);o="absolute"}function x(){if(!w()){h=-1;p.css("display","none");s.css({width:"",position:u,left:"",top:a.top,"margin-left":""});s.removeClass("scroll-to-fixed-fixed");r.options.className&&s.removeClass(r.options.className);o=null}}function T(e){if(e!=h){s.css("left",l-e);h=e}}function N(){var e=r.options.marginTop;return e?typeof e=="function"?e.apply(s):e:0}function C(){if(!e.isScrollToFixed(s))return;var t=i;i||m();var n=e(window).scrollLeft(),o=e(window).scrollTop(),a=g();if(r.options.minWidth&&e(window).width()<r.options.minWidth){if(!w()||!t){L();s.trigger("preUnfixed.ScrollToFixed");x();s.trigger("unfixed.ScrollToFixed")}}else if(r.options.bottom==-1){if(a>0&&o>=a-N()){if(!b()||!t){L();s.trigger("preAbsolute.ScrollToFixed");S();s.trigger("unfixed.ScrollToFixed")}}else if(o>=f-N()){if(!y()||!t){L();s.trigger("preFixed.ScrollToFixed");E();h=-1;s.trigger("fixed.ScrollToFixed")}T(n)}else if(!w()||!t){L();s.trigger("preUnfixed.ScrollToFixed");x();s.trigger("unfixed.ScrollToFixed")}}else if(a>0)if(o+e(window).height()-s.outerHeight(!0)>=a-(N()||-k())){if(y()){L();s.trigger("preUnfixed.ScrollToFixed");u==="absolute"?S():x();s.trigger("unfixed.ScrollToFixed")}}else{if(!y()){L();s.trigger("preFixed.ScrollToFixed");E()}T(n);s.trigger("fixed.ScrollToFixed")}else T(n)}function k(){return r.options.bottom?r.options.bottom:0}function L(){var e=s.css("position");e=="absolute"?s.trigger("postAbsolute.ScrollToFixed"):e=="fixed"?s.trigger("postFixed.ScrollToFixed"):s.trigger("postUnfixed.ScrollToFixed")}var r=this;r.$el=e(t);r.el=t;r.$el.data("ScrollToFixed",r);var i=!1,s=r.$el,o,u,a,f=0,l=0,c=-1,h=-1,p=null,d,v,A=function(e){if(s.is(":visible")){i=!1;C()}},O=function(e){C()},M=function(){var e=document.body;if(document.createElement&&e&&e.appendChild&&e.removeChild){var t=document.createElement("div");if(!t.getBoundingClientRect)return null;t.innerHTML="x";t.style.cssText="position:fixed;top:100px;";e.appendChild(t);var n=e.style.height,r=e.scrollTop;e.style.height="3000px";e.scrollTop=500;var i=t.getBoundingClientRect().top;e.style.height=n;var s=i===100;e.removeChild(t);e.scrollTop=r;return s}return null},_=function(e){e=e||window.event;e.preventDefault&&e.preventDefault();e.returnValue=!1};r.init=function(){r.options=e.extend({},e.ScrollToFixed.defaultOptions,n);r.$el.css("z-index",r.options.zIndex);p=e("<div />");o=s.css("position");u=s.css("position");a=e.extend({},s.offset());w()&&r.$el.after(p);e(window).bind("resize.ScrollToFixed",A);e(window).bind("scroll.ScrollToFixed",O);r.options.preFixed&&s.bind("preFixed.ScrollToFixed",r.options.preFixed);r.options.postFixed&&s.bind("postFixed.ScrollToFixed",r.options.postFixed);r.options.preUnfixed&&s.bind("preUnfixed.ScrollToFixed",r.options.preUnfixed);r.options.postUnfixed&&s.bind("postUnfixed.ScrollToFixed",r.options.postUnfixed);r.options.preAbsolute&&s.bind("preAbsolute.ScrollToFixed",r.options.preAbsolute);r.options.postAbsolute&&s.bind("postAbsolute.ScrollToFixed",r.options.postAbsolute);r.options.fixed&&s.bind("fixed.ScrollToFixed",r.options.fixed);r.options.unfixed&&s.bind("unfixed.ScrollToFixed",r.options.unfixed);r.options.spacerClass&&p.addClass(r.options.spacerClass);s.bind("resize.ScrollToFixed",function(){p.height(s.height())});s.bind("scroll.ScrollToFixed",function(){s.trigger("preUnfixed.ScrollToFixed");x();s.trigger("unfixed.ScrollToFixed");C()});s.bind("detach.ScrollToFixed",function(t){_(t);s.trigger("preUnfixed.ScrollToFixed");x();s.trigger("unfixed.ScrollToFixed");e(window).unbind("resize.ScrollToFixed",A);e(window).unbind("scroll.ScrollToFixed",O);s.unbind(".ScrollToFixed");r.$el.removeData("ScrollToFixed")});A()};r.init()};e.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1e3};e.fn.scrollToFixed=function(t){return this.each(function(){new e.ScrollToFixed(this,t)})}})(jQuery);